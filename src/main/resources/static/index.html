<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web SSH 企业版客户端 · STOMP 版</title>

    <link rel="stylesheet" href="css/styles.css">
    <!-- xterm.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-search@0.13.0/lib/xterm-addon-search.js"></script>

    <!-- STOMP + SockJS -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" />

    <style>
        :root {
            --bg-0: #0f172a;
            --bg-1: #111827;
            --bg-2: #1f2937;
            --card: #0b1220;
            --muted: #94a3b8;
            --text: #e5e7eb;
            --acc: #3b82f6;
            --acc-2: #22c55e;
            --danger: #ef4444;
            --warn: #f59e0b;
            --border: #1f2a44;
        }
        /* 亮色主题 */
        .theme-light {
            --bg-0: #f1f5f9;
            --bg-1: #e2e8f0;
            --bg-2: #cbd5e1;
            --card: #f8fafc;
            --muted: #64748b;
            --text: #1e293b;
            --acc: #3b82f6;
            --acc-2: #10b981;
            --danger: #ef4444;
            --warn: #f59e0b;
            --border: #cbd5e1;
        }
        .hidden { display: none !important; }
        #uploadModal:not(.hidden),
        #fileManagerModal:not(.hidden),
        #createDirModal:not(.hidden) {
            display: grid !important;
        }

        * { box-sizing: border-box; }
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden; /* 防止页面级滚动 */
        }
        body {
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
            "Apple Color Emoji", "Segoe UI Emoji";
            color: var(--text);
            background: radial-gradient(1200px 700px at 80% -10%, #1e293b 0%, #0b1020 60%, #060914 100%),
            linear-gradient(180deg, #0a0f1e, #0a0f1e);
        }
        body.theme-light {
            background: radial-gradient(1200px 700px at 80% -10%, #e2e8f0 0%, #cbd5e1 60%, #94a3b8 100%),
            linear-gradient(180deg, #f1f5f9, #f1f5f9);
        }
        .xterm { height: 100%; }
        .xterm-viewport { overflow-y: auto !important; }
        .xterm-screen { height: auto !important; }
        .btn.secondary {
            background-color: var(--card); /* 或者一个中性色 */
            color: var(--fg);
            border: 1px solid var(--border);
        }
        .btn.secondary:hover {
            background-color: var(--hover);
        }
        .theme-light .btn.secondary {
            background-color: #e2e8f0; /* 亮色主题下的中性背景 */
        }
        .theme-light .btn.secondary:hover {
            background-color: #cbd5e1;
        }
        /* Layout */
        .shell {
            display: grid;
            grid-template-columns: 280px 1fr;
            height: 100dvh;
            overflow: hidden; /* 防止shell容器滚动 */
        }
        .sidebar {
            background: linear-gradient(180deg, #0b1220, #050a17);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden; /* 防止侧边栏整体滚动 */
        }
        .theme-light .sidebar {
            background: linear-gradient(180deg, #f8fafc, #e2e8f0);
        }
        .brand {
            padding: 18px 18px 8px 18px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }
        .brand i { color: var(--acc); }
        .brand .title { font-weight: 700; letter-spacing: .3px; }
        .side-actions {
            padding: 12px 16px;
            display:flex;
            gap:8px;
            flex-shrink: 0;
        }

        .nav {
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex: 1;
            overflow-y: auto; /* 允许导航项滚动 */
        }
        .nav .item {
            display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius: 10px;
            color: var(--muted); cursor:pointer; transition: .2s ease;
            flex-shrink: 0;
        }
        .nav .item:hover { background: #0e1729; color: #cbd5e1; }
        .theme-light .nav .item:hover { background: #e2e8f0; color: #334155; }
        .nav .item.active { background: #0e1729; color: #e5e7eb; border: 1px solid #1a2440; }
        .theme-light .nav .item.active { background: #e2e8f0; color: #1e293b; border: 1px solid #cbd5e1; }

        .sidebar-footer {
            margin-top: auto;
            padding: 10px 14px;
            color: var(--muted);
            font-size: 12px;
            flex-shrink: 0;
        }

        .content {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }
        .topbar {
            display:flex;
            align-items:center;
            justify-content: space-between;
            padding:14px 18px;
            border-bottom:1px solid var(--border);
            background: rgba(8,14,30,.7);
            backdrop-filter: blur(6px);
            flex-shrink: 0;
        }
        .theme-light .topbar {
            background: rgba(241, 245, 249, .7);
        }
        .topbar .right { display:flex; gap:8px; align-items:center; }

        .page {
            height: 100%;
            overflow: hidden; /* 关键修复：防止页面内容滚动 */
            display: flex;
            flex-direction: column;
        }

        /* Cards & forms */
        .card {
            background: rgba(8,14,30,.6);
            border:1px solid var(--border);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,.35) inset, 0 2px 12px rgba(0,0,0,.25);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: 100%;
        }
        .theme-light .card {
            background: rgba(248, 250, 252, .6);
            box-shadow: 0 10px 30px rgba(0,0,0,.1) inset, 0 2px 12px rgba(0,0,0,.1);
        }
        .card .card-hd {
            padding:16px 18px;
            border-bottom:1px solid var(--border);
            display:flex;
            align-items:center;
            justify-content: space-between;
            flex-shrink: 0;
        }
        .card .card-bd {
            padding:16px 18px;
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .grid { display:grid; gap:16px; }
        .grid.cols-2 { grid-template-columns: repeat(2, minmax(0,1fr)); }
        .grid.cols-3 { grid-template-columns: repeat(3, minmax(0,1fr)); }

        .form-row {
            display:grid;
            grid-template-columns: 120px 1fr;
            align-items:center;
            gap:16px;
            margin-bottom: 10px;
        }
        label { color:#cbd5e1; font-size: 14px; }
        .theme-light label { color: #64748b; }
        input, select {
            width:100%;
            padding:12px 14px;
            border-radius: 12px;
            border:1px solid #1a2440;
            background:#0a1328;
            color:#e5e7eb;
            outline: none;
        }
        .theme-light input,
        .theme-light select {
            border:1px solid #cbd5e1;
            background:#f1f5f9;
            color:#1e293b;
        }
        input::placeholder { color:#6b7280; }
        .theme-light input::placeholder { color:#94a3b8; }

        .btn {
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding:10px 14px;
            border-radius: 12px;
            border:1px solid transparent;
            cursor:pointer;
            font-weight:600;
            letter-spacing:.2px;
        }
        .btn:disabled { opacity:.6; cursor:not-allowed; }
        .btn.primary { background: linear-gradient(180deg, #2f68ff, #2a56d6); border-color:#284db7; }
        .btn.green { background: linear-gradient(180deg, #18c964, #0aa652); border-color:#0c8b47; }
        .btn.warn { background: linear-gradient(180deg, #f59e0b, #d97706); border-color:#b45309; }
        .btn.ghost { background: transparent; border-color:#1a2440; color:#cbd5e1; }
        .theme-light .btn.ghost { border-color:#cbd5e1; color:#64748b; }
        .btn.danger { background: linear-gradient(180deg, #ef4444, #b91c1c); border-color:#991b1b; }

        .toolbar { display:flex; gap:10px; flex-wrap: wrap; }

        .alert {
            padding: 10px 12px;
            border-radius: 12px;
            border:1px solid #1a2440;
            display:flex;
            align-items:center;
            gap:8px;
        }
        .theme-light .alert {
            border:1px solid #cbd5e1;
        }
        .alert.info { background:#0b1933; color:#cfe1ff; }
        .theme-light .alert.info { background:#e0f2fe; color:#0369a1; }
        .alert.success { background:#0b2a1a; color:#caffd7; }
        .theme-light .alert.success { background:#dcfce7; color:#15803d; }
        .alert.warn { background:#2b210a; color:#ffe6b3; }
        .theme-light .alert.warn { background:#fef3c7; color:#d97706; }
        .alert.error { background:#2a0d0d; color:#ffd1d1; }
        .theme-light .alert.error { background:#fee2e2; color:#b91c1c; }

        /* Terminal layout - 修复滚动条问题 */
        .terminal-wrap {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }
        .tabs {
            display:flex;
            gap:6px;
            padding:8px;
            border-bottom:1px solid var(--border);
            background: rgba(7,12,25,.5);
            flex-shrink: 0;
        }
        .theme-light .tabs {
            background: rgba(241, 245, 249, .5);
        }
        .tab {
            display:flex;
            align-items:center;
            gap:8px;
            padding:8px 12px;
            border-radius: 12px;
            cursor:pointer;
            background: #091126;
            border:1px solid #1a2440;
            color:#d1d5db;
            flex-shrink: 0;
        }
        .theme-light .tab {
            background: #f1f5f9;
            border:1px solid #cbd5e1;
            color:#64748b;
        }
        .tab.active { background:#0d1a3b; color:#fff; box-shadow: 0 0 0 1px #23315b inset; }
        .theme-light .tab.active { background:#e2e8f0; color:#1e293b; box-shadow: 0 0 0 1px #94a3b8 inset; }
        .tab .close { opacity:.7; }

        .term-stage {
            position: relative;
            overflow: hidden;
            flex: 1;
            min-height: 0;
        }
        .term-pane {
            position:absolute;
            inset:0;
            display:none;
            height: 100%;
            width: 100%;
        }
        .term-pane.active { display:block; }

        /* 确保xterm终端正确显示 */
        .xterm { height: 100%; }
        .xterm-viewport { overflow-y: auto !important; }
        .xterm-screen { height: auto !important; }
        .term-pane.active { display:block; }

        /* 终端搜索条 */
        .term-search {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px;
            border-bottom: 1px solid var(--border);
            background: rgba(7,12,25,.5);
            flex-shrink: 0;
        }
        .theme-light .term-search { background: rgba(241,245,249,.5); }
        .term-search input {
            flex: 1;
            min-width: 0;
            padding: 6px 8px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text);
        }
        .theme-light .term-search input { border:1px solid #cbd5e1; background:#f1f5f9; color:#1e293b; }

        .status {
            display:flex;
            justify-content: space-between;
            padding:8px 12px;
            border-top:1px solid var(--border);
            background: rgba(7,12,25,.6);
            color:#9ca3af;
            font-size:12px;
            flex-shrink: 0;
        }
        .theme-light .status {
            background: rgba(241, 245, 249, .6);
            color:#64748b;
        }

        /* File manager */
        .file-grid-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .file-grid {
            display:grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap:15px;
        }

        .file-card {
            background:#0a1328;
            border:1px solid #1a2440;
            border-radius:12px;
            padding:15px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .theme-light .file-card {
            background:#f1f5f9;
            border:1px solid #cbd5e1;
        }

        .file-card:hover {
            background: #1e293b;
            /*transform: translateY(-2px);*/
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .theme-light .file-card:hover {
            background: #e2e8f0;
        }

        .file-card .icon {
            font-size: 2em;
            margin-bottom: 8px;
        }

        .file-card .name {
            font-size: 0.9em;
            word-break: break-all;
        }

        .file-card.directory .icon {
            color: var(--acc);
        }

        .file-card.file .icon {
            color: var(--muted);
        }

        /* 文件路径区域增强 */
        .file-path {
            padding: 10px 15px;
            background: rgba(30, 41, 59, 0.5);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-light .file-path {
            background: rgba(226, 232, 240, 0.5);
        }

        .file-path .path-container {
            flex: 1;
            min-width: 0; /* 允许内部文本溢出隐藏 */
        }

        .file-path .path-display {
            font-family: monospace;
            font-size: 0.9em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer; /* 提示可点击 */
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .file-path .path-display:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .theme-light .file-path .path-display:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .file-path .path-input {
            font-family: monospace;
            font-size: 0.9em;
            width: 100%;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text);
        }

        .theme-light .file-path .path-input {
            border: 1px solid #cbd5e1;
            background: #f1f5f9;
            color: #1e293b;
        }

        /* 日志面板样式 (如果需要额外调整) */
        #logPanel {
            /* 样式已在 HTML 中定义，这里可以添加更多全局样式 */
        }
        .log-message {
            padding: 2px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .theme-light .log-message {
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        .log-timestamp {
            color: var(--muted);
            margin-right: 8px;
        }
        .theme-light .log-timestamp {
            color: #94a3b8;
        }
        .log-info { color: #93c5fd; }    /* 蓝色 */
        .theme-light .log-info { color: #3b82f6; }
        .log-success { color: #86efac; } /* 绿色 */
        .theme-light .log-success { color: #22c55e; }
        .log-warn { color: #fde047; }    /* 黄色 */
        .theme-light .log-warn { color: #eab308; }
        .log-error { color: #fca5a5; }   /* 红色 */
        .theme-light .log-error { color: #ef4444; }

        /* Utility */
        .mt-10{ margin-top:10px;} .mt-16{margin-top:16px;} .mt-20{margin-top:20px;}
        .hidden { display:none; }
        .text-right { text-align: right; }

        /* 修复滚动条的关键样式 */
        #page-ssh {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        #connection-panel {
            flex-shrink: 0;
            margin-bottom: 16px;
        }

        #terminal-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }

        #terminal-container .card {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        #terminal-container .card-bd {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* SSH表单区域滚动修复 */
        #ssh-form-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 8px;
        }

        /* 自定义滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
            border-radius: 4px;
        }
        .theme-light ::-webkit-scrollbar-track {
            background: rgba(203, 213, 225, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        .theme-light ::-webkit-scrollbar-thumb {
            background: #94a3b8;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        .theme-light ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* 自定义背景样式 */
        body.custom-bg-full {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed; /* 固定背景 */
        }
        body.custom-bg-full .shell {
            /* 可选：为主要内容添加半透明背景以提高可读性 */
            /* background-color: rgba(15, 23, 42, 0.8); */
        }

        .sidebar.custom-bg-sidebar {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            /* 可选：调整侧边栏背景的亮度/对比度 */
            /* filter: brightness(0.8); */
        }
        /* 确保侧边栏内容仍然可见 */
        .sidebar.custom-bg-sidebar .brand,
        .sidebar.custom-bg-sidebar .side-actions,
        .sidebar.custom-bg-sidebar .nav,
        .sidebar.custom-bg-sidebar .sidebar-footer {
            background-color: rgba(11, 18, 32, 0.7); /* 半透明背景 */
            /* 或者使用 backdrop-filter (如果浏览器支持) */
            /* backdrop-filter: blur(2px); background-color: rgba(11, 18, 32, 0.5); */
        }
        .theme-light .sidebar.custom-bg-sidebar .brand,
        .theme-light .sidebar.custom-bg-sidebar .side-actions,
        .theme-light .sidebar.custom-bg-sidebar .nav,
        .theme-light .sidebar.custom-bg-sidebar .sidebar-footer {
            background-color: rgba(248, 250, 252, 0.7);
        }

        /* 文件多选样式 */
        .file-card.selected {
            outline: 2px solid var(--acc); /* 使用主题色高亮选中项 */
            outline-offset: -2px;
            position: relative;
        }
        .file-card.selected::after {
            content: "";
            position: absolute;
            top: 4px;
            right: 4px;
            width: 16px;
            height: 16px;
            background-color: var(--acc);
            border-radius: 50%;
            border: 2px solid var(--card);
            box-sizing: border-box;
        }
        /* 多选工具栏 */
        #fileMultiSelectToolbar {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border-bottom: 1px solid var(--border);
            background: rgba(30, 41, 59, 0.5);
            flex-wrap: wrap; /* 允许按钮换行 */
        }
        .theme-light #fileMultiSelectToolbar {
            background: rgba(226, 232, 240, 0.5);
        }
        #fileMultiSelectToolbar #selectedCount {
            flex-grow: 1; /* 让计数信息占据剩余空间 */
            min-width: 0; /* 允许文本溢出 */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* 文件信息模态框 (如果需要更复杂的显示) */
        #fileInfoModal .modal-content {
            max-width: 500px;
            height: 50%;
        }
        .file-info-grid {
            display: grid;
            grid-template-columns: max-content 1fr;
            gap: 8px 16px;
            align-items: start;
        }
        .file-info-grid .label {
            font-weight: bold;
            text-align: right;
        }
        .file-info-grid .value {
            word-break: break-all;
        }

        /* 全屏终端模式 */
        .fullscreen-terminal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            /*background: #000;*/
        }

        .fullscreen-terminal .card {
            height: 100%;
            border-radius: 0;
            background: transparent;
            border: none;
            box-shadow: none;
        }

        .fullscreen-terminal .card-hd {
            background: rgba(0, 0, 0, 0.7);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .fullscreen-terminal .card-bd {
            padding: 0;
        }

        .fullscreen-terminal .terminal-wrap {
            height: calc(100% - 50px); /* 减去标题栏高度 */
        }

        .fullscreen-terminal .tabs {
            background: rgba(0, 0, 0, 0.7);
        }

        .fullscreen-terminal .status {
            background: rgba(0, 0, 0, 0.7);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Modals */
        .modal {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            backdrop-filter: blur(2px);
            background: rgba(0,0,0,.35);
            z-index: 1001;
        }

        .modal-content {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,.35);
            width: 95%;
            max-width: 1000px;
            height: 90vh;
            max-height: 95vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-header {
            padding: 16px 18px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .modal-body {
            padding: 0;
            overflow: hidden;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .modal-footer {
            padding: 16px 18px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        /* 文件操作菜单 */
        .file-context-menu {
            position: absolute;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1002;
            min-width: 150px;
            display: none;
        }

        .file-context-menu.show {
            display: block;
        }

        .file-context-menu .menu-item {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-context-menu .menu-item:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        /* 上传模态框特殊样式 */
        #uploadModal .modal-content,
        #createDirModal .modal-content {
            width: 90%;
            max-width: 520px;
            height: auto;
            max-height: 90vh;
        }
    </style>
</head>
<body>
<div class="shell">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="brand">
            <i class="fas fa-terminal fa-lg"></i>
            <div>
                <div class="title">Web SSH</div>
                <div style="font-size:12px; color:var(--muted)">Enterprise · STOMP</div>
            </div>
        </div>

        <div class="side-actions">
            <button class="btn ghost" onclick="createNewTab()"><i class="fa fa-plus"></i> 新建标签</button>
            <button class="btn ghost" onclick="toggleTheme()"><i class="fa fa-moon"></i></button>
        </div>

        <nav class="nav">
            <div class="item active" data-page="ssh" onclick="switchPage('ssh', this)"><i class="fas fa-terminal"></i><span>SSH 连接</span></div>
            <div class="item" onclick="switchPage('dashboard', this)"><i class="fa fa-chart-line"></i> 仪表盘</div>
            <div class="item" data-page="files" onclick="switchPage('files', this)"><i class="fas fa-folder"></i><span>文件管理</span></div>
            <div class="item" data-page="settings" onclick="switchPage('settings', this)"><i class="fas fa-gear"></i><span>设置</span></div>
        </nav>

        <div class="sidebar-footer">v1.0 · STOMP 客户端</div>
    </aside>

    <!-- Main -->
    <main class="content">
        <div class="topbar">
            <div style="display:flex; align-items:center; gap:10px;">
                <i class="fa fa-server" style="color:var(--acc)"></i>
                <div>连接管理</div>
            </div>
            <div class="right">
                <span id="latencyWrap" class="alert info" title="与服务器的近似网络延迟"><i class="fa fa-wave-square"></i><span id="latencyText">延迟 -- ms</span></span>
                <span id="reconnectWrap" class="alert warn hidden" title="断线后将自动重连"><i class="fa fa-clock"></i><span id="reconnectText">重连 0s</span></span>
                <span id="connState" class="alert info"><i class="fa fa-circle-notch fa-spin" style="display:none" id="stateSpin"></i><span id="stateText">未连接</span></span>
                <button class="btn ghost" onclick="refreshSaved()"><i class="fa fa-rotate"></i></button>
            </div>
        </div>

        <!-- Pages -->
        <section class="page" id="page-ssh">
            <!-- 连接面板 - 添加ID便于定位 -->
            <div id="connection-panel" class="grid cols-2" style="padding:16px; gap:16px;">
                <!-- Connection card -->
                <div class="card">
                    <div class="card-hd">
                        <div style="display:flex; align-items:center; gap:8px;"><i class="fa fa-plug"></i><b>SSH 连接面板</b></div>
                        <div class="toolbar">
<!--                            <button class="btn primary" onclick="connectSSH()"><i class="fa fa-plug"></i> 连接</button>-->
                            <button class="btn green" onclick="testConnection()" id="testBtn"><i class="fa fa-vial"></i> 测试</button>
<!--                            <button class="btn danger" onclick="disconnectSSH()" id="disconnectBtn" disabled><i class="fa fa-xmark"></i> 断开</button>-->
                        </div>
                    </div>
                    <div class="card-bd">
                        <!-- SSH表单区域滚动容器 -->
                        <div id="ssh-form-container">
                            <div class="grid cols-2">
                                <div class="form-row"><label>快速连接</label>
                                    <select id="savedServers" onchange="loadServerConfig()">
                                        <option value="">选择已保存的服务器...</option>
                                    </select>
                                </div>
                                <div class="form-row"><label>服务器名称</label><input id="serverName" placeholder="给这个连接起个名字"/></div>
                                <div class="form-row"><label>服务器地址</label><input id="host" placeholder="192.168.1.100 或 example.com" value="localhost"/></div>
                                <div class="form-row"><label>端口</label><input id="port" type="number" value="22"/></div>
                                <div class="form-row"><label>用户名</label><input id="username" placeholder="root"/></div>
                                <div class="form-row"><label>密码</label><input id="password" type="password" placeholder="••••••"/></div>
                            </div>
                            <div class="mt-10" style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <!-- 连接按钮 -->
                                <button class="btn primary" onclick="connectSSH()"><i class="fa fa-plug"></i> 连接</button>
                                <!-- 显式的保存到服务器按钮 -->
                                <button class="btn secondary" id="saveToServerBtn" onclick="manuallySaveToServer()">
                                    <i class="fa fa-cloud-arrow-up"></i> 保存到服务器
                                </button>
                                <!-- (可选) 保存到本地按钮 - 如果需要手动触发本地保存 -->
                                <!-- <button class="btn ghost" onclick="manuallySaveToLocal()"><i class="fa fa-bookmark"></i> 保存到本地</button> -->
                                <!-- 断开按钮 -->
                                <button class="btn danger" id="disconnectBtn" onclick="disconnectSSH()" disabled><i class="fa fa-unlink"></i> 断开</button>
                            </div>
<!--                            <div id="alertContainer" class="mt-16"></div>-->
                        </div>
                    </div>
                </div>

                <!-- Tips card -->
                <div class="card">
                    <div class="card-hd"><div style="display:flex; align-items:center; gap:8px;"><i class="fa fa-circle-info"></i><b>提示</b></div></div>
                    <div class="card-bd">
                        <div class="alert info"><i class="fa fa-shield"></i> 生产环境建议在服务端限制 <b>allowed origins</b>，前端仅通过 HTTPS 访问。</div>
                        <div class="alert warn mt-10"><i class="fa fa-triangle-exclamation"></i> 如果使用小程序或原生 WebSocket 客户端，建议关闭 SockJS，仅保留 ws/wss。</div>
                        <div class="alert success mt-10"><i class="fa fa-check"></i> 本页面已适配 STOMP：<code>/app/ssh/*</code> 收发，订阅 <code>/user/queue/output</code>。</div>
                    </div>
                </div>
            </div>

            <!-- Terminal - 修复滚动条问题 -->
            <!-- Terminal - 修复滚动条问题 -->
            <div id="terminal-container" style="padding: 0 16px 16px; flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                <div class="card" style="height: 100%; display: flex; flex-direction: column;">
                    <div class="card-hd" style="justify-content: flex-start; gap:8px;">
                        <div class="toolbar">
                            <button class="btn ghost" onclick="createNewTab()"><i class="fa fa-plus"></i> 新建终端</button>
                            <button class="btn ghost" onclick="fitActiveTerminal()"><i class="fa fa-expand"></i> 全屏终端</button>
                            <button class="btn ghost" onclick="clearActive()"><i class="fa fa-eraser"></i> 清屏</button>
                            <!-- 添加切换日志显示的按钮 -->
                            <button class="btn ghost" onclick="toggleLogPanel()"><i class="fa fa-history"></i> 日志</button>
                        </div>
                    </div>
                    <!-- 添加日志面板 (默认隐藏) -->
                    <div id="logPanel" class="card-bd hidden" style="border-top: 1px solid var(--border); padding: 10px; height: 200px; overflow-y: auto; background: rgba(0,0,0,0.1);">
                        <div id="logMessages" style="font-family: monospace; font-size: 0.85em;"></div>
                    </div>
                    <!-- /添加日志面板 -->
                    <div class="card-bd" style="flex: 1; overflow: hidden; display: flex; flex-direction: column;">
                        <div class="terminal-wrap">
                            <div id="termSearchBar" class="term-search hidden">
                                <i class="fa fa-magnifying-glass"></i>
                                <input id="termSearchInput" placeholder="搜索 (Enter 下一个 / Shift+Enter 上一个)" />
                                <button class="btn ghost" onclick="doSearchPrev()" title="上一个"><i class="fa fa-arrow-up"></i></button>
                                <button class="btn ghost" onclick="doSearchNext()" title="下一个"><i class="fa fa-arrow-down"></i></button>
                                <button class="btn ghost" onclick="hideSearchBar()" title="关闭"><i class="fa fa-xmark"></i></button>
                            </div>
                            <div class="tabs" id="terminalTabs"></div>
                            <div class="term-stage" id="terminalStage"></div>
                            <div class="status"><span id="statusLeft">就绪</span><span id="statusRight">行: 24, 列: 80</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 仪表盘 -->
        <section class="page hidden" id="page-dashboard">
            <div style="padding:16px;">
                <div class="card">
                    <div class="card-hd">
                        <b>服务器仪表盘</b>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <select id="dashboardServerSelect" onchange="loadDashboardData()">
                                <option value="">选择服务器...</option>
                                <!-- 选项将通过 JS 动态填充 -->
                            </select>
                            <button class="btn primary" onclick="loadDashboardData()"><i class="fa fa-sync"></i> 刷新</button>
                        </div>
                    </div>
                    <div class="card-bd">
                        <div id="dashboardContent">
                            <div class="alert info">请从下拉列表中选择一个服务器。</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Files page -->
        <section class="page hidden" id="page-files">
            <div style="padding:16px; height: 100%; display: flex; flex-direction: column;">
                <div class="card" style="flex: 1; display: flex; flex-direction: column; height: 100%;">
                    <div class="card-hd">
                        <b>文件管理器</b>
                        <div class="toolbar">
                            <button class="btn primary" onclick="refreshFilesPage()"><i class="fa fa-sync"></i> 刷新服务器列表</button>
                        </div>
                    </div>
                    <div class="card-bd" style="display: flex; flex-direction: column; overflow: hidden;">
                        <div class="alert info">请选择一个已连接的服务器来管理文件。</div>
                        <div id="filesServerList" class="mt-16" style="flex: 1; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings page -->
        <section class="page hidden" id="page-settings">
            <div style="padding:16px;">
                <div class="card"><div class="card-hd"><b>设置</b></div><div class="card-bd">
                    <!-- 设置 -->
                    <div class="settings-grid"> <!-- 新增的包裹容器 -->
                        <!-- 背景设置 -->
                        <div class="setting-group"> <!-- 为每个设置组添加一个容器，方便样式管理 -->
                            <h4>背景设置</h4> <!-- 可选：为每个部分添加小标题 -->
                            <div class="form-row">
                                <label for="backgroundType">背景类型</label>
                                <select id="backgroundType">
                                    <option value="default">默认</option>
                                    <option value="sidebar">侧边栏背景</option>
                                    <option value="full">全页面背景</option>
                                </select>
                            </div>
                            <div class="form-row" id="backgroundImageRow" style="display: none;">
                                <label for="backgroundImage">背景图片</label>
                                <input type="file" id="backgroundImage" accept="image/*" />
                                <div class="mt-10">
                                    <button class="btn ghost" onclick="clearBackgroundImage()">清除背景图片</button>
                                </div>
                            </div>
                            <div class="mt-16 text-right">
                                <button class="btn primary" onclick="applySettings()">应用背景设置</button> <!-- 可选：修改按钮文字以明确作用 -->
                            </div>
                        </div>
                        <!-- /背景设置 -->

                        <!-- 终端字体设置 -->
                        <div class="setting-group">
                            <h4>终端字体</h4>
                            <div class="form-row">
                                <label for="terminalFontFamily">字体</label>
                                <select id="terminalFontFamily">
                                    <option value="monospace">默认等宽字体</option>
                                    <option value="'Fira Code', monospace">Fira Code</option>
                                    <option value="Monaco, monospace">Monaco</option>
                                    <option value="Consolas, monospace">Consolas</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label for="terminalFontSize">字体大小</label>
                                <input type="number" id="terminalFontSize" min="10" max="30" value="14" />
                            </div>
                            <div class="mt-16 text-right">
                                <button class="btn primary" onclick="applyTerminalSettings()">应用字体设置</button>
                            </div>
                        </div>
                        <!-- 快捷键说明 -->
                        <div class="setting-group">
                            <h4>快捷键</h4>
                            <div class="form-row"><label>清屏</label><div>Ctrl / ⌘ + K</div></div>
                            <div class="form-row"><label>搜索</label><div>Ctrl / ⌘ + F（打开/聚焦搜索栏）</div></div>
                            <div class="form-row"><label>搜索导航</label><div>Enter 下一个，Shift+Enter 上一个</div></div>
                            <div class="form-row"><label>切换标签</label><div>Alt + ↑ / ↓ 或 Alt + ← / →</div></div>
                            <div class="form-row"><label>退出全屏</label><div>Esc</div></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- 文件管理器模态框 -->
<div id="fileManagerModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <b>文件管理器 - <span id="fileManagerServerName"></span></b>
            <button class="btn ghost" onclick="closeFileManager()"><i class="fa fa-times"></i></button>
        </div>
        <div id="fileMultiSelectToolbar" class="toolbar hidden" style="padding: 10px; border-bottom: 1px solid var(--border); background: rgba(30, 41, 59, 0.5);">
            <span id="selectedCount">已选择 0 项</span>
            <button class="btn danger" onclick="bulkDeleteSelectedFiles()"><i class="fa fa-trash"></i> 批量删除</button>
            <button class="btn primary" onclick="bulkDownloadSelectedFiles()"><i class="fa fa-download"></i> 批量下载</button>
            <button class="btn ghost" onclick="clearFileSelection()"><i class="fa fa-times"></i> 取消选择</button>
        </div>
        <div class="file-path">
            <button class="btn ghost" onclick="goToParentDirectory()"><i class="fa fa-arrow-up"></i> 上级</button>
            <!-- 修改路径显示区域 -->
            <div class="path-container">
                <div id="currentPathDisplay" class="path-display" title="点击跳转到路径">/</div>
                <input type="text" id="currentPathInput" class="path-input hidden" placeholder="输入路径..." />
            </div>
            <!-- /修改路径显示区域 -->
            <button class="btn ghost" onclick="refreshFileManager()"><i class="fa fa-sync"></i></button>
        </div>
        <div class="modal-body">
            <div id="fileGridContainer" class="file-grid-container">
                <div id="fileList" class="file-grid">
                    <!-- 文件列表将在这里动态生成 -->
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <div>
                <button class="btn ghost" onclick="showCreateDirModal()"><i class="fa fa-folder-plus"></i> 新建目录</button>
            </div>
            <div class="file-actions">
                <button class="btn primary" onclick="showUploadModal()"><i class="fa fa-upload"></i> 上传文件</button>
            </div>
        </div>
    </div>
</div>
<!-- 文件信息模态框 -->
<div id="fileInfoModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <b id="fileInfoTitle">文件属性</b>
            <button class="btn ghost" onclick="closeFileInfoModal()"><i class="fa fa-times"></i></button>
        </div>
        <div class="modal-body" style="padding: 20px; overflow-y: auto;">
            <div class="file-info-grid">
                <span class="label">名称:</span>
                <span id="infoFileName" class="value">-</span>

                <span class="label">类型:</span>
                <span id="infoFileType" class="value">-</span>

                <span class="label">大小:</span>
                <span id="infoFileSize" class="value">-</span>

                <span class="label">修改时间:</span>
                <span id="infoFileModified" class="value">-</span>

                <span class="label">权限:</span>
                <span id="infoFilePermissions" class="value">-</span>
            </div>
        </div>
        <div class="modal-footer" style="padding: 16px; border-top: 1px solid var(--border); text-align: right;">
            <button class="btn primary" onclick="closeFileInfoModal()">关闭</button>
        </div>
    </div>
</div>
<!-- 上传文件模态框 -->
<div id="uploadModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <b>上传文件</b>
            <button class="btn ghost" onclick="closeUploadModal()"><i class="fa fa-xmark"></i></button>
        </div>
        <div class="modal-body" style="padding: 16px 18px;">
            <div class="grid">
                <div class="form-row"><label>选择文件</label><input id="uploadFiles" type="file" multiple /></div>
                <div class="form-row"><label>上传路径</label><input id="uploadPath" value="/" /></div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn ghost" onclick="closeUploadModal()">取消</button>
            <button class="btn primary" onclick="handleUpload()">上传</button>
        </div>
    </div>
</div>

<!-- 新建目录模态框 -->
<div id="createDirModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <b>新建目录</b>
            <button class="btn ghost" onclick="closeCreateDirModal()"><i class="fa fa-times"></i></button>
        </div>
        <div class="modal-body" style="padding: 16px 18px;">
            <div class="form-row">
                <label>目录名称</label>
                <input id="newDirName" placeholder="请输入目录名称" />
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn ghost" onclick="closeCreateDirModal()">取消</button>
            <button class="btn primary" onclick="createDirectory()">创建</button>
        </div>
    </div>
</div>

<!-- 文件操作上下文菜单 -->
<div id="fileContextMenu" class="file-context-menu">
    <div class="menu-item" onclick="downloadSelectedFile()"><i class="fa fa-download"></i> 下载</div>
    <div class="menu-item" onclick="deleteSelectedFile()"><i class="fa fa-trash"></i> 删除</div>
    <div class="menu-item" onclick="renameSelectedFile()"><i class="fa fa-edit"></i> 重命名</div>
    <div class="menu-item" onclick="showFileInfo()"><i class="fa fa-info-circle"></i> 属性</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<script src="js/main.js"></script>
</body>
</html>